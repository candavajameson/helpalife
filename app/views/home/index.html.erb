<% provide(:title, 'Voluntary Blood Donors Community.Post your requirements,Get donor info and notify donors via instant SMS and EMAIL.Register as a Blood Donor and help a life') %>
<div class="search-box"  >
  <!-- a simple div with some links -->
  <br>
  <!-- Prefixfree -->
  <script src="http://thecodeplayer.com/uploads/js/prefixfree-1.0.7.js" type="text/javascript" type="text/javascript"></script>
  <div class="doner-search container"  style="height: 150px; text-align: center">
    <div class="breadcrumb">
      <a href="#" class="active">Select blood group,state,district</a>
      <a href="#">Click search donors</a>
      <a href="#">Find donors</a>
      <a href="#">Get donor's details</a>
      <a href="#">Notify donors via SMS and Email</a>
    </div>

    <%= simple_form_for(User.new, :as => :user, :url => donors_path(:user),
                        :html => { :method => :get} ) do |f| %>

            <%= f.select :blood_group, options_for_select([["A1+", "A1+"],["A1-", "A1-"], ["A2+", "A2+"],["A2-", "A2-"],
                                                               ["B+", "B+"],["B-", "B-"],["A1B+", "A1B+"],["A1B-", "A1B-"],
                                                               ["A2B+", "A2B+"],["A2B-", "A2B-"],["AB+", "AB+"],
                                                               ["AB-", "AB-"],["O+", "O+"],["O-", "O-"],["A+", "A+"],
                                                               ["A-", "A-"]]) , :prompt => "- Choose blood group -",
                             :required => true %>


          <%= f.collection_select :state_id, State.order(:name), :id, :name,
                                                :prompt => "- Select state -"%>
          <%= f.grouped_collection_select :district_id, State.order(:name), :districts, :name, :id, :name,
                                          :prompt => "- Select district -"%>
          <%= f.button :submit, "Search donors" ,class:'btn btn-primary' %>
    <% end %>
        </div>



  <br>
  <div class="doner-search container" >
         <br>
    <b>Post your requirement</b>
    <br><br>

    <%@need ||= Need.new%>
    <%= simple_form_for @need do |f| %>
        <div>
        <%= f.select :blood_group, options_for_select([["A1+", "A1+"],["A1-", "A1-"], ["A2+", "A2+"],["A2-", "A2-"],
                                                       ["B+", "B+"],["B-", "B-"],["A1B+", "A1B+"],["A1B-", "A1B-"],
                                                       ["A2B+", "A2B+"],["A2B-", "A2B-"],["AB+", "AB+"],
                                                       ["AB-", "AB-"],["O+", "O+"],["O-", "O-"],["A+", "A+"],
                                                       ["A-", "A-"]]) , :prompt => "- Choose blood group -",
                     :required => true ,:style=>"margin: 1;"%>  &nbsp;&nbsp;&nbsp;

        <%= f.text_field :required_date ,:data_behaviour => 'datepicker', :required => true ,:placeholder=> "Required Date"%>&nbsp;&nbsp;&nbsp;
        <%= f.text_field :required_units, :required => true ,:placeholder=> "Require Units"%>&nbsp;&nbsp;&nbsp;

        </div>
        <br>

        <div>
        <%= f.text_field :contact_number, :required => true ,:phone_field => true,:placeholder=> "Mobile Number"%>&nbsp;&nbsp;&nbsp;

        <%= f.collection_select :state_id, State.order(:name), :id, :name,
                                :prompt => "- Select state -"%>&nbsp;&nbsp;&nbsp;
        <%= f.grouped_collection_select :district_id, State.order(:name), :districts, :name, :id, :name,
                                        :prompt => "- Select district -"%>&nbsp;&nbsp;&nbsp;

        </div>

        <br>
        <div>
          <%= f.text_field :hospital_name , :required => true ,:placeholder=> "Hospital Name"%>&nbsp;&nbsp;&nbsp;
          <%= f.text_field :patient_name,:placeholder=> "Patient Name", :required => true%>&nbsp;&nbsp;&nbsp;
          <%= f.text_field :reason,:placeholder=> "Reason", :required => true%>&nbsp;&nbsp;&nbsp;
          </div>
        <br>
        <% if user_signed_in? %>
            <%= f.button :submit, "Post Need" ,id: "post_need",class:'btn  btn-large' %>
        <% else %>
            <a href="#login" data-toggle="modal" class ='btn  btn-large'>Post Need</a>
        <% end %>

    <% end %>


  </div>
  <br>

 <% if @needs.any? %>
    <%= render 'home/recent_needs' %>
 <% end  %>
<%= render 'home/recent_users' %>

</div>
<script type="text/javascript">
//    for search doners
    jQuery(function() {
        var districts;
        districts = $('#user_district_id').html();
        return $('#user_state_id').change(function() {
            var escaped_state, options, state;
            state = $('#user_state_id :selected').text();
            escaped_state = state.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g, '\\$1');
            options = $(districts).filter("optgroup[label='" + escaped_state + "']").html();
            if (options) {
                $('#user_district_id').html(options);
                $('#user_district_id').show();
                return $('#district_label').show();
            } else {
                $('#user_district_id').empty();
                $('#user_district_id').hide();
                return $('#district_label').hide();
            }
        });
    });

//for post need selection

jQuery(function() {
    var districts;
    districts = $('#need_district_id').html();
    return $('#need_state_id').change(function() {
        var escaped_state, options, state;
        state = $('#need_state_id :selected').text();
        escaped_state = state.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g, '\\$1');
        options = $(districts).filter("optgroup[label='" + escaped_state + "']").html();
        if (options) {
            $('#need_district_id').html(options);
            $('#need_district_id').show();
            return $('#district_label').show();
        } else {
            $('#need_district_id').empty();
            $('#need_district_id').hide();
            return $('#district_label').hide();
        }
    });
});


//bread crumps

$('.btn-group a').on('click', function(event){
        event.preventDefault();
        var input = $(this).siblings('.control-group').find('input[type=hidden]');
        if(input.length>0){
            if(input.val().toString() !== $(this).data('value').toString()){
                input.val($(this).data('value')).trigger('change');
            }
        }
    });

//Need validation
    $("#post_need").click(function() {
        if ($("#need_blood_group").find("option:selected" ).text() == '- Choose blood group -') {
            alert("Please select a blood group");}

        if ($("#need_state_id").find("option:selected" ).text() == '- Select state -'){
            alert("Please select state");}

        if ($("#need_district_id").find("option:selected" ).text() == '- Select district -'){
            alert("Please select district");}



    });

</script>

