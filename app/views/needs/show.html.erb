<% provide(:title, "#{@need.patient_name}, Needs #{@need.blood_group} blood." ) %>
<%set_meta_tags :og => {
:title    => "#{@need.patient_name}, Needs #{@need.blood_group} blood.",
:type     => 'Blood donors',
:url      => need_url(@need),
:image    => image_url('logo.png'),
:description => "#{@need.patient_name}, Needs #{@need.blood_group} blood,Contact Number: #{@need.contact_number}"
} %>
<% "Contact Number: #{@need.contact_number}" %>
<br>
<script src="http://thecodeplayer.com/uploads/js/prefixfree-1.0.7.js" type="text/javascript" type="text/javascript"></script>
<div class="doner-search container"  style=" text-align: center; height: auto;">
  <div class="breadcrumb">
    <a href="#" >Select blood group,state,district</a>
    <a href="#" >Click search donors</a>
    <a href="#" >Find donors</a>
    <a href="#" class="active">Get donor's details</a>
    <a href="#" class="active">Notify donors via SMS and Email</a>
  </div>

    <br>

    <%@need ||= Need.new%>
    <%= simple_form_for @need , :url => {:action=>"update"} do |f| %>
        <div>
          <%= f.select :blood_group, options_for_select([["A1+", "A1+"],["A1-", "A1-"], ["A2+", "A2+"],["A2-", "A2-"],
                                                         ["B+", "B+"],["B-", "B-"],["A1B+", "A1B+"],["A1B-", "A1B-"],
                                                         ["A2B+", "A2B+"],["A2B-", "A2B-"],["AB+", "AB+"],
                                                         ["AB-", "AB-"],["O+", "O+"],["O-", "O-"],["A+", "A+"],
                                                         ["A-", "A-"]], :selected => @need.blood_group ) ,
                       :required => true ,:style=>"margin: 1;"  %>  &nbsp;

          <%= f.text_field :required_date ,:data_behaviour => 'datepicker', :required => true ,:placeholder=> "Required Date"%>&nbsp;&nbsp;&nbsp;
          <%= f.text_field :required_units, :required => true ,:placeholder=> "Require Units"%>&nbsp;&nbsp;&nbsp;

        </div>
      <br>

      <div>
        <%= f.text_field :contact_number, :required => true ,:placeholder=> "Mobile Number"%>&nbsp;&nbsp;&nbsp;

        <%= f.collection_select :state_id, State.order(:name), :id, :name,
                                :prompt => "- Select state -"%>&nbsp;&nbsp;&nbsp;
        <%= f.grouped_collection_select :district_id, State.order(:name), :districts, :name, :id, :name,
                                        :prompt => "- Select district -"%>&nbsp;&nbsp;&nbsp;

      </div>

      <br>
      <div>
        <%= f.text_field :hospital_name , :required => true ,:placeholder=> "Hospital Name"%>&nbsp;&nbsp;&nbsp;
        <%= f.text_field :patient_name,:placeholder=> "Patient Name", :required => true%>&nbsp;&nbsp;&nbsp;
        <%= f.text_field :reason,:placeholder=> "Reason" , :required => true%>&nbsp;&nbsp;&nbsp;
        </div>
        <br>
      <% if user_signed_in? and current_user.needs.include?(@need)  %>
          <%= f.button :submit, "Update Need" ,id: "notify_need",class:'btn  btn-large' %>
      <% end %>
    <% end %>


  <div>Found &nbsp;<%=pluralize(@users.count, 'Donor')%></div>
</div>

<br>

<div class="container" >
  <% if @users.any? %>
  <div class="row">
    <% @users.each do |user|  %>
        <div class="span6" style= "background-color: #3b494c;
                border-radius: 5px;
                color: white;margin-bottom: 5px;">
          <div style="float: left;padding: 6px;">
            <% if user.avatar_url.nil? %>
                <%=  image_tag("user_missing.png",:class =>"img img-circle",:style => "width: 75px;")%>
            <% else  %>
                <%= image_tag(user.avatar_url,:class =>"img img-circle",:style => "width: 75px;")%>
            <% end  %>
          </div>

          <div>
            <h4><%=truncate(user.name,length: 25, omission: '..') %> &nbsp;&nbsp; <%=user.blood_group %></h4>
          </div>
          <div style="float: left;">
            <%=user.state.name %>,
            <%=user.district.name %>
          </div>
          <br>
          <div style="float: right;padding: 0px 19px 0px 0px;">
            Phone No:<% if user.phone_no_visibility %>
                <%= user.phone_no  %>
            <% else  %>
                private
                <!--say thanks...-->
            <% end %>
          </div>
        </div>
    <% end  %>
  </div>
  <% else  %>
      <div>Sorry, currently no donors for this selection criteria. </div>
      <br>
      <b>But you can post your requirement in the home page and you can share that in social medias.</b>
      <%= render 'referrals/site_referrals' %>

  <% end %>

</div>
<%=will_paginate @users%>

<script type="text/javascript">
    jQuery(function() {
        var districts;
        districts = $('#user_district_id').html();
        return $('#user_state_id').change(function() {
            var escaped_state, options, state;
            state = $('#user_state_id :selected').text();
            escaped_state = state.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g, '\\$1');
            options = $(districts).filter("optgroup[label='" + escaped_state + "']").html();
            if (options) {
                $('#user_district_id').html(options);
                $('#user_district_id').show();
                return $('#district_label').show();
            } else {
                $('#user_district_id').empty();
                $('#user_district_id').hide();
                return $('#district_label').hide();
            }
        });
    });

    $('.btn-group a').on('click', function(event){
        event.preventDefault();
        var input = $(this).siblings('.control-group').find('input[type=hidden]');
        if(input.length>0){
            if(input.val().toString() !== $(this).data('value').toString()){
                input.val($(this).data('value')).trigger('change');
            }
        }
    });

</script>
